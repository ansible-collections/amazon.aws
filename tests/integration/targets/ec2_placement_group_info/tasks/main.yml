- module_defaults:
    group/aws:
      access_key: "{{ aws_access_key }}"
      secret_key: "{{ aws_secret_key }}"
      session_token: "{{ security_token | default(omit) }}"
      region: "{{ aws_region }}"
  block:
  - name: Create a placement group
    amazon.aws.ec2_placement_group:
      group_name: "{{ ec2_placement_group_name }}"
      strategy: cluster
      state: present
    register: cluster_placement_group
  
  - name: Get placement group info
    amazon.aws.ec2_placement_group_info:
      group_name: "{{ ec2_placement_group_name }}"
    register: placement_group_info

  - name: Validate placement group
    ansible.builtin.assert:
      that:
        - placement_group_info.placement_groups | length > 0
        - placement_group_info.placement_groups[0].group_name == ec2_placement_group_name
        - group_id in placement_group_info.placement_groups[0]
