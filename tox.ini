[tox]
skipsdist=True
envlist = clean,ansible{2.12,2.13}-py{38,39,310}-{with_constraints,without_constraints}

[testenv]
deps =
  pytest
  pytest-cov
  ansible2.12: ansible-core>2.12,<2.13
  ansible2.13: ansible-core>2.13,<2.14
  !ansible2.12-!ansible2.13: ansible-core
  pytest-ansible-units
  -rtest-requirements.txt
  with_constraints: -rtests/unit/constraints.txt
commands = pytest --cov-report html --cov plugins/callback --cov plugins/inventory --cov plugins/lookup --cov plugins/module_utils --cov plugins/modules plugins {posargs:tests/}

[testenv:clean]
deps = coverage
skip_install = true
commands = coverage erase

[testenv:complexity-report]
deps =
  # See: https://github.com/lordmauve/flake8-html/issues/30
  flake8>=3.3.0,<5.0.0'
  flake8-html
commands = -flake8 --select C90 --max-complexity 10 --format=html --htmldir={posargs} plugins

[testenv:black]
install_command = pip install {opts} {packages}
commands =
  black -v -l160 .

[testenv:linters]
install_command = pip install {opts} {packages}
commands =
  black -v -l160 --diff --check .
  #flake8 {posargs}
  yamllint -s .

[testenv:venv]
commands = {posargs}

[flake8]
# E123, E125 skipped as they are invalid PEP-8.

show-source = True
ignore = E123,E125,E402,W503,W504
max-line-length = 160
builtins = _
exclude = .git,.tox,tests/unit/compat/
